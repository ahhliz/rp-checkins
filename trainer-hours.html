<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trainer Hours Submission</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #1e1e1e;
      color: #dfd8ce;
      padding: 2rem;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background-color: #1e1e1e;
      padding: 2rem;
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    th, td {
      padding: 0.75rem;
      border: 1px solid #dfd8ce;
      text-align: left;
    }
    select, input[type="text"], input[type="date"], input[type="number"] {
      width: 100%;
      padding: 0.5rem;
      border-radius: 8px;
      border: none;
      box-sizing: border-box;
      background-color: #2a2a2a;
      color: #dfd8ce;
    }
    button {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      background-color: #dfd8ce;
      color: #1e1e1e;
      cursor: pointer;
      margin: 1rem 0.5rem;
    }
    button:hover {
      background-color: #e5ded2;
      box-shadow: 0 0 10px rgba(223, 216, 206, 0.4);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .delete-btn {
      color: #ff6961;
      font-weight: bold;
      font-size: 1.2rem;
      cursor: pointer;
      text-align: center;
    }
    #totalHours {
      font-weight: 600;
      margin-top: 1rem;
    }
    /* Loading Modal Overlay */
    #loadingModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: #1e1e1e;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.7);
      text-align: center;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #dfd8ce;
      border-top: 4px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .hidden { display: none; }
  </style>
</head>
<body>
<!-- Loading Modal -->
<div id="loadingModal">
  <div class="modal-content">
    <div class="spinner"></div>
    <p>Loading trainers...</p>
  </div>
</div>

<div style="text-align: center; margin-bottom: 2rem;">
  <img src="https://resolveperformance.com.au/wp-content/uploads/2024/10/RESOLVE-PERFORMANCE-site-logo.svg" alt="Resolve Performance Logo" style="max-width: 220px;">
</div>

<!-- Trainer selection -->
<div class="container" id="trainerSelect" style="max-width: 400px;">
  <h1>Select Your Name</h1>
  <select id="trainerName" disabled style="margin-bottom: 1rem; font-size: 1rem; padding: 0.75rem;">
    <option value="">-- Select Trainer --</option>
  </select>
  <div style="text-align: center;">
    <button id="continueBtn" onclick="startSubmission()" disabled style="font-size: 1.25rem;">Continue</button>
  </div>
</div>

<!-- Weekly Hours Section -->
<div class="container hidden" id="hourForm">
  <h2 id="formHeader">Submit Weekly Hours</h2>
  <div class="table-wrapper">
    <table id="hoursTable">
      <thead>
      <tr><th>Date</th><th>Task</th><th>Notes</th><th style="width: 10%;">Hours</th><th>Delete</th></tr>
      </thead>
      <tbody id="tableBody">
      <tr>
        <td><input type="date"></td>
        <td>
          <select>
            <option value="">-- Select Activity --</option>
            <option>Marketing & Video Content</option>
            <option>Team Training Sessions</option>
            <option>Trainer Training</option>
            <option>Meal Plans & Training Programs</option>
            <option>Cleaning</option>
            <option>Other</option>
          </select>
        </td>
        <td><input type="text" placeholder="Details (optional)"></td>
        <td><input type="number" min="0" step="0.25" class="hourInput"></td>
        <td class="delete-btn" onclick="deleteRow(this)">üóëÔ∏è</td>
      </tr>
      </tbody>
    </table>
  </div>
  <button onclick="addRow()">Add Another Row</button>
  <button onclick="reviewSubmission()">Confirm</button>
  <p id="totalHours">Total Hours: 0</p>
</div>

<!-- Cancellations Section -->
<div class="container hidden" id="cancellationPage">
  <h2>Submit Cancellations</h2>
  <div class="table-wrapper">
    <table id="cancellationsTable">
      <thead>
      <tr><th>Date</th><th style="width:35%;">Client Name</th><th>Notes</th><th>Hours</th><th>Delete</th></tr>
      </thead>
      <tbody>
      <tr>
        <td><input type="date"></td>
        <td>
          <select class="clientDropdown">
            <option value="">-- Select Client --</option>
          </select>
        </td>
        <td><input type="text" placeholder="Details (optional)"></td>
        <td><input type="number" min="0" step="0.25"></td>
        <td class="delete-btn" onclick="deleteRow(this)">üóëÔ∏è</td>
      </tr>
      </tbody>
    </table>
  </div>
  <button onclick="addCancellationRow()">Add Another Cancellation</button>
  <button onclick="proceedToConfirmation()">Next</button>
</div>

<!-- Confirmation Section -->
<div class="container hidden" id="confirmationPage">
  <h1>Confirm Your Submission</h1>
  <div id="summary"></div>
  <div id="cancellationSummary"></div>
  <button onclick="submitForm()">Confirm</button>
  <button onclick="goBackToCancellations()">Go Back</button>
</div>

<script>
  // ‚úèÔ∏è Replace this with your actual Web-App /exec URL:
  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby6sni7Au-ayYUKqFuJHFdlkAM5Gbz0r0qSTVHRMuWCH66Pas7qfy0ycY2DMO-qn4hiVw/exec';

  let selectedTrainer = '';
  let weeklyEntries = [];
  let cancellationEntries = [];

  function startSubmission() {
    const name = document.getElementById('trainerName').value;
    if (!name) return alert('Please select your name.');
    selectedTrainer = name;
    document.getElementById('formHeader').innerText = `Submit Weekly Hours ‚Äî ${selectedTrainer}`;
    document.getElementById('trainerSelect').classList.add('hidden');
    document.getElementById('hourForm').classList.remove('hidden');
  }

  function addRow() {
    const table = document.getElementById('tableBody');
    const row = table.rows[0].cloneNode(true);
    row.querySelectorAll('input, select').forEach(i=> i.value = '');
    table.appendChild(row);
    updateTotal();
  }

  function deleteRow(el) {
    const row = el.closest('tr');
    const table = row.parentNode;
    if (table.rows.length > 1) {
      row.remove();
      updateTotal();
    } else {
      alert('At least one row must remain.');
    }
  }

  function updateTotal() {
    let total = 0;
    document.querySelectorAll('.hourInput').forEach(i => {
      const v = parseFloat(i.value);
      if (!isNaN(v)) total += v;
    });
    document.getElementById('totalHours').textContent = `Total Hours: ${total}`;
  }
  document.getElementById('tableBody').addEventListener('input', updateTotal);

  function reviewSubmission() {
    weeklyEntries = [];
    const rows = document.querySelectorAll('#tableBody tr');
    let valid = true;
    let html = `<h2>Trainer: ${selectedTrainer}</h2><ul>`;

    rows.forEach(r => {
      const date  = r.cells[0].querySelector('input').value;
      const task  = r.cells[1].querySelector('select').value;
      const notes = r.cells[2].querySelector('input').value;
      const hrs   = r.cells[3].querySelector('input').value;
      if (!date || !task || !hrs) {
        valid = false;
      } else {
        // push to batch
        weeklyEntries.push({
          date,
          time: '',
          trainer: selectedTrainer,
          duration: hrs,
          task,
          notes,
          cancelled: 'false'
        });
        // build summary HTML
        const fd = new Date(date).toLocaleDateString('en-GB');
        html += `<li><strong>${fd}</strong>: ${task} (${hrs} hrs)` + (notes? ` - ${notes}` : '') + `</li>`;
      }
    });
    html += `</ul>`;

    if (!valid) return alert('Please fill in all required fields before continuing.');

    document.getElementById('summary').innerHTML = html;
    document.getElementById('hourForm').classList.add('hidden');
    document.getElementById('cancellationPage').classList.remove('hidden');
  }

  function addCancellationRow() {
    const tb = document.querySelector('#cancellationsTable tbody');
    const row = tb.rows[0].cloneNode(true);
    row.querySelectorAll('input, select').forEach(i=> i.value = '');
    tb.appendChild(row);
  }

  function proceedToConfirmation() {
    cancellationEntries = [];
    const rows = document.querySelectorAll('#cancellationsTable tbody tr');
    let html = '<h2>Cancellations</h2><ul>';

    rows.forEach(r => {
      const date   = r.cells[0].querySelector('input').value;
      const client = r.cells[1].querySelector('select').value;
      const notes  = r.cells[2].querySelector('input').value;
      const hrs    = r.cells[3].querySelector('input').value;
      if (date && client && hrs) {
        cancellationEntries.push({
          date,
          time: '',
          trainer: selectedTrainer,
          duration: hrs,
          client,
          email: '',
          notes,
          cancelled: 'true'
        });
        const fd = new Date(date).toLocaleDateString('en-GB');
        html += `<li>${fd}: ${client} (${hrs} hrs)` + (notes? ` - ${notes}` : '') + `</li>`;
      }
    });
    html += `</ul>`;

    document.getElementById('cancellationSummary').innerHTML = html;
    document.getElementById('cancellationPage').classList.add('hidden');
    document.getElementById('confirmationPage').classList.remove('hidden');
  }

  function goBackToCancellations() {
    document.getElementById('confirmationPage').classList.add('hidden');
    document.getElementById('cancellationPage').classList.remove('hidden');
  }

  async function submitForm() {
    try {
      // send weekly sessions
      for (let row of weeklyEntries) {
        await fetch(WEB_APP_URL, {
          method: 'POST',
          body: new URLSearchParams(row)
        });
      }
      // send cancellations
      for (let row of cancellationEntries) {
        await fetch(WEB_APP_URL, {
          method: 'POST',
          body: new URLSearchParams(row)
        });
      }
      alert('All done! üëç');
      window.location.reload();
    } catch (err) {
      console.error(err);
      alert('Something went wrong submitting your data.');
    }
  }

  // ‚îÄ‚îÄ‚îÄ Load Trainers Dynamically ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  document.addEventListener('DOMContentLoaded', async () => {
    const dropdown = document.getElementById('trainerName');
    const continueBtn = document.getElementById('continueBtn');
    const modal = document.getElementById('loadingModal');

    dropdown.disabled = true;
    continueBtn.disabled = true;
    modal.style.display = 'flex';

    // your own echo/web-app URL returning { trainers: [ 'Mia', 'Alexa', ... ] }
    const trainerListUrl = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLhGrpXns9GE2lA0eWyQdKVfqWBhSXJDRFL0102xh_PilsXrprqIYEUJo7Y_jKa9EGDTGMqNdo2j0HW7OW4JIelwVQS0Qk3KfxjgA8CcWMjehTew0pljoYMCJoFiw0HuXNEYj0521NWf5TSBOQZSE61-wKmMT2ZMlydu7NLHETQF0G_XCth9DqiZ_tJ_NHXDljaWSsUZTimf5_stgY3HtcoGK1Eujd6LC-GXqULpmIyrdiiWJPKmAEVU9L-nqwfx12xe8s8GXPwyukoUgmKAST_vb8frFlANYA6w_0Kz&lib=MjTRnn9JtmhEyalh9NFjedpgJUstJXK7c';

    try {
      const res = await fetch(trainerListUrl);
      const data = await res.json();
      dropdown.innerHTML = '<option value="">-- Select Trainer --</option>';
      data.trainers.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        dropdown.appendChild(opt);
      });
    } catch (err) {
      console.error('Failed to load trainers:', err);
      dropdown.innerHTML = '<option value="">Error loading trainers</option>';
    } finally {
      modal.style.display = 'none';
      dropdown.disabled = false;
      continueBtn.disabled = false;
    }
  });
</script>
</body>
</html>
